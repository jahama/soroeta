<?php// Check to ensure this file is included in Joomla!defined( '_JEXEC' ) or die( 'Restricted access' );jimport( 'joomla.application.component.view');/** * HTML View class for the Registration component * * @package		Joomla * @subpackage	Registration * @since 1.0 */class bleagueViewplayer extends JView{	function display($tpl = null)	{		$mainframe = JFactory::getApplication();		JHTML::_('behavior.modal', 'a.team-images');		$pathway  =& $mainframe->getPathway();		$document =& JFactory::getDocument();		$params	= &$mainframe->getParams();	 	// Page Title		$menus	= &JSite::getMenu();		$menu	= $menus->getActive();		// because the application sets a default page title, we need to get it		// right from the menu item itself			// table league		$player_id = JRequest::getVar( 'id', 0, '', 'int' );		$s_id = JRequest::getVar( 'sid', 0, '', 'int' );		    /*    we need to know if we should get into consideration season_id          */		//if(!$player_id || !$s_id){    if(!$player_id){			JError::raiseError( 403, JText::_('Access Forbidden') );			return; 		}				$db			= & JFactory::getDBO();				$query = "SELECT p.*,ps.p_name,t.t_name FROM #__bl_players as p LEFT JOIN #__bl_positions as ps ON p.position_id = ps.p_id, #__bl_teams as t WHERE t.id = p.team_id AND p.id = ".$player_id;		$db->setQuery($query);		$players = $db->loadObjectList();		$player = $players[0];				if (is_object( $menu )) {			$menu_params = new JRegistry;// new JParameter( $menu->params );			if (!$menu_params->get( 'page_title')) {				$params->set('page_title',	JText::_( $player->first_name.' '.$player->last_name ));			}		} else {			$params->set('page_title',	JText::_( $player->first_name.' '.$player->last_name.' ('.$player->t_name.')' ));		}		$document->setTitle( $params->get( 'page_title' ) );		$pathway->addItem( JText::_( $player->first_name.' '.$player->last_name ));				$query = "SELECT p.ph_name as name,p.id as id,p.ph_filename as filename FROM #__bl_assign_photos as ap, #__bl_photos as p WHERE ap.photo_id = p.id AND cat_type = 1 AND cat_id = ".$player_id;		$db->setQuery($query);		$photos = $db->loadObjectList();				$def_img = '';		if($player->def_img){			$query = "SELECT ph_filename FROM  #__bl_photos as p WHERE p.id = ".$player->def_img;			$db->setQuery($query);			$def_img = $db->loadResult();		}else if(isset($photos[0])){			$def_img = $photos[0]->filename;		}				$query = "SELECT ef.*,ev.fvalue as fvalue FROM #__bl_extra_filds as ef LEFT JOIN #__bl_extra_values as ev ON ef.id=ev.f_id AND ev.uid=".$player_id." WHERE ef.published=1 AND ef.type='0' ORDER BY ef.ordering";		$db->setQuery($query);		$this->ext_fields = $db->loadObjectList();			//---------------PLayer Statistic-------------//		$stat_array = array();				$query = "SELECT DISTINCT(ev.id),ev.* FROM #__bl_events as ev, #__bl_match_events as me, #__bl_match as m, #__bl_matchday as md WHERE ev.id = me.e_id AND me.match_id = m.id AND m.m_id=md.id ".(($s_id)?"AND md.s_id=".$s_id:"")." AND ev.player_event = 1  ORDER BY ev.id";		$db->setQuery($query);		$events = $db->loadObjectList();				for($j=0;$j<count($events);$j++){						$stat_array[$j][0] = $events[$j]->e_name;						$db->setQuery("SELECT SUM(me.ecount) FROM #__bl_match_events as me, #__bl_match as m, #__bl_matchday as md WHERE me.e_id = ".$events[$j]->id." AND me.player_id = ".$player_id." AND me.match_id = m.id AND m.m_played = 1 AND md.id=m.m_id ".(($s_id)?"AND md.s_id=".$s_id:""));			$stat_array[$j][1] = intval($db->loadResult());						$stat_array[$j][2] = '&nbsp;';			if($events[$j]->e_img && is_file('media/bearleague/events/'.$events[$j]->e_img)){				$stat_array[$j][2] = '<img src="media/bearleague/events/'.$events[$j]->e_img.'" title="'.$events[$j]->e_name.'" height="20" />';			}		}					//---language-----------//	require_once(JPATH_ROOT.DS.'components'.DS.'com_joomsport'.DS.'bl_lang.php');				$this->assignRef('bl_lang', $bl_lang);		$this->assignRef('params',		$params); 		$this->assignRef('player', $player); 		$this->assignRef('def_img',		$def_img);		$this->assignRef('photos',		$photos);				$this->assignRef('stat_array',		$stat_array);		parent::display($tpl);	}		}